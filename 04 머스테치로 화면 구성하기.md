# 04 머스테치로 화면 구성하기

# 1. 서버 템플릿 엔진과 머스테치 소개  

템플릿 엔진 : 지정된 템플릿 양식과 데이터가 합쳐져 HTML문서를 출력하는 소프트웨어       
과거에는 자바스크립트처럼 HTML + JAVA의 형식으로 HTML에 데이터를 넣어 동적으로 활용했다면(서버 템플릿 엔진)
최근에는 클라이언트 템플릿 엔진인 React, Vue.js 등을 이용해 구현함

자바스크립트는 기본적으로 브라우저에서 작동되므로 서버 템플릿 엔진의 손을 벗어나게 되어 서버에서 제어를 할 수가 없는 단점이 존재한다.         
클라이언트 템플릿 엔진인 React, Vue 에서 서버는 json 혹은 xml형식의 데이터만 전달하고 클라이언트에서 조립하게 되어 이전의 문제점을 해결한다.

## 1.1 머스테치란

현존하는 대부분의 언어를 지원하는  템플릿 엔진.
스프링 진형에선 Thymeleaf(굉장히 밀어주고 있음) 과 비슷하나, 개인적으로는 조금 더 문법이 쉽다.

자바에서 사용할 때는 서버 템플릿 엔진으로, 자바스크립트에서 사용될 때는 클라이언트 템플릿 엔진으로 모두 사용할 수 있는 장점이 있음
또한 로직 코드를 사용할 수 없어 View의 역할과 서버의 역할을 명확하게 분리하며 나의 문법으로 클라이언트/서버 템플릿을 모두 사용가능하다.

## 1.2 머스테치 사용(인텔리제이)

설정 - 플러그인 - 머스테치 설치

![image](https://user-images.githubusercontent.com/104341003/178152559-f184ca3a-986c-45b8-b810-9b2944a80bbf.png)


build.gradle 의존성 추가

```C
    implementation 'org.springframework.boot:spring-boot-starter-mustache'
    testImplementation 'org.springframework.boot:spring-boot-starter-mustache'
```


![image](https://user-images.githubusercontent.com/104341003/178152582-e72eae74-8de3-4447-a15f-124e666383fa.png)


## 1.3 페이지 작성 및 컨트롤러 연결

머스테치 파일의 기본 위치는 ```src/main/resources/templates```이며, 이 위치에 머스테치 파일을 두면 스프링 부트에서 자동으로 로딩한다.   

index.mustache를 ```src/main/resources/templates```에 생성


**index.mustache**   
```mustache
<!doctype html>
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>스프링 부트 웹 서버</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/app/bgimg.css">
</head>
<body>
    <h1>스프링 부트로 시작하는 웹 서비스 ver.2</h1>
</body>
</html>    
```

전체 프로젝트에 web 패키지를 만들고 하위에 indexController Class를 만든다.
해당 URL을 매핑하여, 클라이언트가 Get으로 기본 URL을 요청하면, 위에 만든 머스테치 파일이 보이도록 진행한다.
mustache의 의존성을 추가하면 컨트롤러에서 문자열을 반환할 때 뷰 리졸버에 의해 앞의 경로와 뒤의 파일 확장자는 자동으로 지정된다.(.mustache)

```java
@RequiredArgsConstructor
@Controller
public class IndexController {

    @GetMapping("/")
    public String index(){
        return "index";
    }
}

```

실제 테스트는 Test 패키지에 동일한 경로를 만들어, 테스트한다.


```java
@ExtendWith(SpringRunner.class)
@SpringBootTest(webEnvironment = RANDOM_PORT)
public class IndexControllerTest {

    @Autowired
    private TestRestTemplate restTemplate;

    @Test
    public void 메인페이지_로딩(){
        // when
        String body = this.restTemplate.getForObject("/",String.class);

        // then
        assertThat(body).contains("스프링 부트로 시작하는 웹 서비스");
        // 포함된 내용이 없으 False 리턴
    }
}

```

테스트 후 정상적으로 작동하면, Application의 메인메소드를 실행하여 브라우저에 접속해서 확인한다.
```http://localhost:8080``` -> index.mustache 실행됨


## 2.1 게시글 등록 화면 만들기
       
각각에 파일에 레이아웃을 적용하는 것이 아닌 레이아웃을 별도로 분리하여 각 머스테치에 추가해 사용하는 방법으로 진행한다.          
이렇게 사용하는 이유는 반복되는 코드를 줄이며 변경시 혹은 유지보수시 레이아웃 부분만 고치면 모두 변경되기 때문이다.
다음과 같이 진행한다.

1. ```src/main/resources/templates```에 ```layout```폴더 생성     
2. ```src/main/resources/templates/layout```에 header.mustache 생성      
3. ```src/main/resources/templates/layout```에 footer.mustache 생성     


**header.mustache**
```mustache
<!doctype html>
<head>
    <meta http-equiv="Content-Type" content="text/html" charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>스프링 부트 웹 서버</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="/css/app/bgimg.css">
</head>
```
   
**footer.mustache**
```mustache
<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
<script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js"></script>

</body>
</html>
```

## 2.2 index.mustache 수정

분리한 레이아웃을 index.mustache에 추가하며
글 등록 버튼을 추가한다.
    
**index.mustache**
```mustache
{{>layout/header}}
    <h1>스프링 부트로 시작하는 웹 서비스</h1>
    <div class="col-md-12">
        <!-- 로그인 기능 영역 -->
        <div class="row">
            <div class="col-md-6">
                <a href="/posts/save" role="button" class="btn btn-primary">글 등록</a>
            </div>
        </div>
    </div>

{{>layout/footer}}
```

해당 코드에서 작성된 주소 ```/posts/save```를 매핑하는 Controller를 작성한다.


